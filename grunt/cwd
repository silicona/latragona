function mostrarIdiomas(){semaforo||mostrarMenu(),lengua?($("#menuidiomas").css("display","block"),$("#menuidiomas").animate({opacity:1},1e3),lengua=!1):($("#menuidiomas").animate({opacity:0},1e3,function(){$("#menuidiomas").css("display","none")}),lengua=!0)}function mostrarMenu(){lengua||mostrarIdiomas();var ancho=$(window).width(),pag_global="{}"==JSON.stringify($("#lateral"));if(576<=ancho&&ancho<=1024&&pag_global){var top_contenedor=$("#contenedor").offset().top;$("#menumovil").css("top",top_contenedor-$("#menumovil").height()+5),semaforo?($("#menumovil").css("display","block"),$(function(){$("html, body").animate({scrollTop:$("#menumovil").offset().top+3},1e3)}),$("#menumovil").animate({opacity:1},1e3),semaforo=!1):($(function(){$("html, body").animate({scrollTop:top_contenedor+3},1e3)}),$("#menumovil").animate({opacity:0},1e3,function(){$("#menumovil").css("display","none")}),semaforo=!0)}else semaforo?($("#menumovil").css("display","block"),$("#menumovil").animate({opacity:1},1e3),semaforo=!1):($("#menumovil").animate({opacity:0},1e3,function(){$("#menumovil").css("display","none")}),semaforo=!0)}function desvanecerLeer(){var tope=document.documentElement.scrollTop||document.body.scrollTop,altura=$(window).height();switch(!0){case altura/2<tope&&tope<.6*altura:$("#leer").css("opacity","0");break;case.4*altura<tope&&tope<altura/2:$("#leer").css("opacity","0.4");break;case.2*altura<tope&&tope<.4*altura:$("#leer").css("opacity","0.8");break;case tope<.2*altura:$("#leer").css("opacity","1")}}function encender_comidas(){switch(576<=ancho_ventana?(altura_aviso_rac=$("#aviso_rac").offset().top-44,altura_reservas=$("#reservas").offset().top-44):(altura_aviso_rac=$("#aviso_rac").offset().top-(44+altura_lateral),altura_reservas=$("#reservas").offset().top-(44+altura_lateral)),!0){case scroll_top>=altura_reservas||scroll_top+$(window).height()==$(document).height():marcadores[2].style.backgroundColor="#000000",marcadores[2].style.color="#FFFFFF";break;case scroll_top>=altura_aviso_rac&&scroll_top<altura_reservas:marcadores[1].style.backgroundColor="#000000",marcadores[1].style.color="#FFFFFF";break;case scroll_top<altura_aviso_rac:marcadores[0].style.backgroundColor="#000000",marcadores[0].style.color="#FFFFFF"}}function encender_bebidas(){switch(576<=ancho_ventana?(altura_cerveza=$("#cerveza").offset().top-44,altura_vino=$("#vino").offset().top-44,altura_licor=$("#licores").offset().top-44,altura_combi=$("#combinados").offset().top-44,altura_sin=$("#sin_alcohol").offset().top-44):(altura_cerveza=$("#cerveza").offset().top-(44+altura_lateral),altura_vino=$("#vino").offset().top-(44+altura_lateral),altura_licor=$("#licores").offset().top-(44+altura_lateral),altura_combi=$("#combinados").offset().top-(44+altura_lateral),altura_sin=$("#sin_alcohol").offset().top-(44+altura_lateral)),!0){case scroll_top>=altura_sin||scroll_top+$(window).height()==$(document).height():marcadores[4].style.backgroundColor="#000000",marcadores[4].style.color="#FFFFFF";break;case scroll_top>=altura_combi&&scroll_top<altura_sin:marcadores[3].style.backgroundColor="#000000",marcadores[3].style.color="#FFFFFF";break;case scroll_top>=altura_licor&&scroll_top<altura_combi:marcadores[2].style.backgroundColor="#000000",marcadores[2].style.color="#FFFFFF";break;case scroll_top>=altura_vino&&scroll_top<altura_licor:marcadores[1].style.backgroundColor="#000000",marcadores[1].style.color="#FFFFFF";break;case scroll_top<altura_vino:marcadores[0].style.backgroundColor="#000000",marcadores[0].style.color="#FFFFFF"}}function iluminarLateral(scroll_top,raciones){for(raciones=raciones||"",marcadores=document.getElementById("lateral").getElementsByTagName("li"),a=0;a<marcadores.length;a++)marcadores[a].style.backgroundColor="initial",marcadores[a].style.color="#000";raciones?encender_comidas():encender_bebidas()}function mostrarLateral(){if(ancho_ventana=window.innerWidth||document.body.offsetWidth,scroll_top=$(window).scrollTop(),altura_lateral=$("#lateral").height(),"{}"!=JSON.stringify($("#aviso_pan"))){var $primero=$("#aviso_pan");raciones=!0}else{$primero=$("#cerveza");raciones=!1}576<=ancho_ventana?scroll_top>$primero.offset().top-44?$("#lateral").show():$("#lateral").hide():scroll_top>$primero.offset().top-(44+altura_lateral)?$("#lateral").show():$("#lateral").hide(),iluminarLateral(scroll_top,raciones)}function animarFancy(){"{}"!=JSON.stringify($("#aviso_pan"))?$("[data-fancybox]").fancybox({toolbar:!1,smallBtn:!0,iframe:{preload:!1,css:{width:"400px",height:"430px"}}}):$("[data-fancybox]").fancybox({toolbar:!1,smallBtn:!0,iframe:{preload:!1,css:{width:"400px",height:"550px"}}})}function calcularHorario(){var fecha=new Date,dia=fecha.getDay(),hora=fecha.getHours();return preposicion=mapa_en+" ",apertura=!1,1<dia?2==dia||4==dia?19<hora&&hora<24?(apertura=!0,apertura):(tiempo=20-hora,1<tiempo?tiempo+=" "+mapa_horas+".":tiempo+=" "+mapa_hora+".",tiempo=preposicion+tiempo,apertura,tiempo):12<hora&&hora<16||19<hora&&hora<24?(apertura=!0,apertura):(tiempo=hora<13?13-hora:20-hora,1<tiempo?tiempo+=" "+mapa_horas+".":tiempo+=" "+mapa_hora+".",tiempo=preposicion+tiempo,apertura,tiempo):0==dia?11<hora&&hora<17?(apertura=!0,apertura):(tiempo=hora<12?12-hora:36,1<tiempo?tiempo+=" "+mapa_horas+".":tiempo+=" "+mapa_hora+".",tiempo=preposicion+tiempo,apertura,tiempo):(tiempo=mapa_mañana,apertura,tiempo)}function iniciarMapa(){ancho_ventana=window.innerWidth||document.body.offsetWidth;var ancho=$("#mapa").css("width").slice(0,3);calcularHorario();var tragona={lat:40.41121079,lng:-3.70549053};centro_mapa=500<=ancho?{lat:40.41121079,lng:-3.7063}:tragona;var mapa=new google.maps.Map(document.getElementById("mapa"),{zoom:17,center:centro_mapa});apertura?aviso=mapa_abierto:aviso=mapa_abrimos+" "+tiempo,aviso="Volvemos el 2 de Abril";var descripcion='<div id="mapa_info"><div id="aviso">'+aviso+'</div><h1 id="info_cabecera">La Tragona<img src="'+mapa_logo+'" id="imagen_mapa"></h1><div id="info_contenido"><p><strong>La Tragona</strong> '+mapa_info+"</p></div></div>",informacion=new google.maps.InfoWindow({content:descripcion}),marcador=new google.maps.Marker({position:tragona,map:mapa,title:"La Tragona (Madrid)"});marcador.addListener("click",function(){informacion.open(mapa,marcador)})}function permite(elEvento,permitidos){var caracteres=" abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZ_.@";switch(permitidos){case"num":permitidos="0123456789";break;case"car":permitidos=caracteres;break;case"num_car":permitidos="0123456789 abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZ_.@"}var evento=elEvento||window.event,codigoCaracter=evento.charCode||evento.keyCode,caracter=String.fromCharCode(codigoCaracter),tecla_especial=!1,teclas_especiales=[8,37,39,40,41,43,46];for(var i in teclas_especiales)if(codigoCaracter==teclas_especiales[i]){tecla_especial=!0;break}return-1!=permitidos.indexOf(caracter)||tecla_especial}function limpiarFormulario(formulario){$.each($formulario[0],function(index,value){if("enviar"==value.name)return!0;value.value="","telefono"==value.name&&(value.value="(+34)")})}function enviar_mensaje(datos){imagen='<img class="spinner" src="'+BASE_FILE+'media/la_tragona_logo.png" width="50">',$respuesta_form.html(imagen),datos.idioma=idioma,$.ajax({dataType:"json",type:"POST",url:BASE_URL+"/php/formulario.php",data:datos,context:$formulario}).done(function(mi_json){""!=mi_json&&setTimeout(function(){var respuesta='<p class="respuesta_'+mi_json.status+'">'+mi_json.mensaje+"</p>";$respuesta_form.html(respuesta),limpiarFormulario($formulario)},2e3)})}function validarForm(e){e.preventDefault(),$formulario=$(e.target).parent(),$respuesta_form=$("#respuesta_form",$formulario),datos={};var error={};if($.each($formulario[0],function(index,input){switch(input.value=$.sanear($(this).val()),input.name){case"nombre":if(""==input.value)return error.status=!0,error.mensaje=$(this).attr("data_error"),this.focus(),!1;break;case"email":if(!/[\d\w\._]+@(?:[\d\w\.]+)?[\d\w]+\.\w{2,4}/.test(input.value))return error.status=!0,error.mensaje=$(this).attr("data_error"),this.focus(),!1;break;case"telefono":if(input.value=input.value.replace(/\s/g,""),!/^\(\+\d{2}\)\d{9}$/.test(input.value))return error.status=!0,error.mensaje=$(this).attr("data_error"),input.value="(+34)",this.focus(),!1;break;case"mensaje":if(""==input.value||/^\s+$/.test(input.value))return error.status=!0,error.mensaje=$(this).attr("data_error"),this.focus(),!1}datos[input.name]=input.value}),error.status)return $respuesta_form.html('<p class="respuesta_error">'+error.mensaje+"</p>"),!1;enviar_mensaje(datos)}function activarClicks(){$("#leer").click(function(){$("html, body").animate({scrollTop:$("#contenedor").offset().top+3},1500)}),$(".menu").click(function(){mostrarMenu()}),$("#multi").click(function(){mostrarIdiomas()}),$(".boton","#lateral").click(function(e){e.preventDefault();var posicion=$($(this).attr("data_seccion")).offset().top-43;$(document).width()<576&&(posicion-=$("#lateral").height()),$("html, body").animate({scrollTop:posicion},2e3)}),$(".boton","#form").click(function(e){e.preventDefault(),validarForm(e)})}function iniciar(){semaforo=!0,lengua=!0,activarClicks()}!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||((js=d.createElement(s)).id=id,js.src="//connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.9",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk"),function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?"http":"https";d.getElementById(id)||((js=d.createElement(s)).id=id,js.src=p+"://platform.twitter.com/widgets.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","twitter-wjs"),"{}"!=JSON.stringify($("#lateral"))&&(animarFancy(),window.onscroll=mostrarLateral),jQuery.sanear=function(valor){return valor.replace(/<script[^>]*?>.*?<\/script>/gi,"").replace(/<[\/\!]*?[^<>]*?>/gi,"").replace(/<style[^>]*?>.*?<\/style>/gi,"").replace(/<![\s\S]*?--[ \t\n\r]*>/gi,"")},window.onscroll=desvanecerLeer,window.onload=iniciar;